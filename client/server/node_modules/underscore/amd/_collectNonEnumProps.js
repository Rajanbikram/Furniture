define(['./_setup', './isFunction', './_has'], function (_setup, isFunction, _has) {
  function emulatedSet(keys) {
    var hash = {};
    for (var l = keys.length, i = 0; i < l; ++i) hash[keys[i]] = true;
    return {
      contains: function(key) { return hash[key] === true; },
      push: function(key) {
        hash[key] = true;
        return keys.push(key);
      }
    };
  }
  function collectNonEnumProps(obj, keys) {
    keys = emulatedSet(keys);
    var nonEnumIdx = _setup.nonEnumerableProps.length;
    var constructor = obj.constructor;
    var proto = (isFunction(constructor) && constructor.prototype) || _setup.ObjProto;
    var prop = 'constructor';
    if (_has(obj, prop) && !keys.contains(prop)) keys.push(prop);
    while (nonEnumIdx--) {
      prop = _setup.nonEnumerableProps[nonEnumIdx];
      if (prop in obj && obj[prop] !== proto[prop] && !keys.contains(prop)) {
        keys.push(prop);
      }
    }
  }
  return collectNonEnumProps;
});
